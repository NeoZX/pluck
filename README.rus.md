[EN](README.md) [RU](README.ru.md)

# О проекте
Данная утилита разработана для уменьшения размера файла базы данных СУБД 
[Firebird](https://firebirdsql.org/) без выполнения операций бекапа и 
восстановления.

# Принцип работы
На первом этапе утилита ищет свободные страницы по данным PIP и освобождает блоки 
в свободных страницах. 

На втором этапе утилита анализирует использование страниц. Если на странице 
есть не используемые блоки, тогда эти блоки освобождаются.
Анализируются страницы следующих типов: данные, b-tree индекс, BLOB. Эти три 
типа страниц составляют >99% от общего количества страниц. 

Размер блока по умолчанию 4096 байт. Размер блока должен быть такой же как 
размер блока ввода/вывода файловой системы. В ext4 по умолчанию размер блока 
ввода/вывода 4096 байт.

При освобождении блока на уровне файловой системе на дисковое устройство 
отправляется команда trim, освобождающая блока на дисковом устройстве. Будет 
команда отправлятся синхронно или для этого потребуется выполнить команду 
fstrim зависит от настроек монтирования файловой системы, смотрите описание 
опции discard в документации по файловой системе.

Не рекомендуется использовать на HDD накопителях, так как может приводить к 
фрагментации файла. На SSD накопителя фрагментация файла практически не влияет 
на скорость работы и время доступа.

#ПРЕДОСТЕРЕЖЕНИЯ
Уменьшение размера файла базы данных может быть полезно и необходимо в 
некоторых случаях. Например если в базе данных выполняются только читающие 
транзакции в OLAP моделях, аналитика, статистика и т.п.
Возможно ситуация, когда размер файла будет больше размера ФС. Таким образом 
возникнет ситуация при которой на ФС нет свободных блоков, но в файле есть 
свободные страницы. Такая ситуация может приводить к не предвиденным ошибкам 
в работе СУБД. 

# Требования
* Операционная система Linux x86_64
* glibс 2.18 (поддержка флагов FALLOC_FL_*)
* kernel 2.6.38 если используется файловая система XFS
* kernel 3.0 если используется файловая система Ext4

# Пример использования
Запуск в пробном режиме, по умолчанию:

    ./pluck -f database.fdb

Запуск с освобождением страниц:

    ./pluck -t -f database.fdb

# Ограничения
Поддерживается структура БД (ODS) для Firebird 2.X и Ред База Данных 2.X.
Поддерживается размер блока 512 и 4096, по умолчанию 4096.
Поддерживаемые ОС Linux. 